<!DOCTYPE html>
<html>

<head>
  <script src="js/header-loader.js" onload="loadHeader('Message Feed')"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
  <script src="js/feed-page-loader.js"></script>
  <link rel="stylesheet" href="/css/message.css" />
  <link rel="stylesheet" href="/css/feed-page.css" />
  <script>
    function cleanWindowLocation(windowLocation) {
      return windowLocation.replace("\?&", "?").replace(/\?$/, "");
    }

    function checkUniqueImageLabel(imageLabel) {
      const parameterImageLabels = urlParams.getAll("imageLabel");
      if (parameterImageLabels.indexOf(imageLabel) > -1) {
        return false;
      }
      return true;
    }

    function onClickSearchButton() {
      const imageLabel = document
        .getElementById("search-input")
        .value.toLowerCase();
      if (checkUniqueImageLabel(imageLabel)) {
        let redirectLocation = window.location.href;
        const parameterImageLabels = urlParams.getAll("imageLabel");
        redirectLocation += redirectLocation.includes("?") ? "&" : "?";
        redirectLocation += `imageLabel=${imageLabel}`;
        window.location.replace(cleanWindowLocation(redirectLocation));
      } else {
        document.getElementById("search-input").value = "";
      }
    }

    function onClickImageLabelCancelButton(imageLabel) {
      let redirectLocation = cleanWindowLocation(
        window.location.href.replace(
          new RegExp(`&?imageLabel=${imageLabel}`, "g"),
          ""
        )
      );
      window.location.replace(redirectLocation);
    }

    function goToMaps(){
      window.location.href= "google-map.html";
    }

  </script>
</head>

<body onload="buildUI()">
  <div class="text-center page-header">
    <h1 class="display-4">Message Feed</h1>
    <p class="font-weight-lighter">
      See all messages posted by the PhotoBook community here!
    </p>
  </div>

  <div id="content-container">
    <div class="search-sort-container border-bottom pb-4 mb-5">
      <div class="d-flex justify-content-between">
        <div class="search-bar mb-3">
          <input type="text" class="searchText font-weight-lighter" placeholder="Search by image label"
            onfocus="this.placeholder = ''" onblur="this.placeholder = 'Search by image label'" id="search-input" />
          <button type="submit" class="searchButton" onclick="onClickSearchButton()">
            <i class="fa fa-search"></i>
          </button>
        </div>
        <div class="sort-menu input-group mb-3">
          <select class="custom-select" id="sortCriteriaMenu">
            <option selected>Choose sort criteria</option>
            <option value="Most Recent">Most Recent (default)</option>
            <option value="Least Recent">Least Recent</option>
            <option value="Positive to Negative">Positive to Negative</option>
            <option value="Negative to Positive">Negative to Positive</option>
          </select>
          <div class="input-group-append">
            <label class="input-group-text bg-info text-light sort-menu-label" for="sortCriteriaMenu">
              Sort By
            </label>
          </div>
        </div>
      </div>
      <div class="search-tag-container d-flex flex-wrap" id="search-tag-container"></div>
    </div>

    <div class="message-container mt-5">
      <div id="message-cards-container" class="card-columns">
        Loading...
      </div>
    </div>
  </div>
  <div class="text-center add-marker-manually">
        <button type="button" onclick="goToMaps()">Mark your places on the map manually!</button>
  </div><br><br>
</body>
</html>